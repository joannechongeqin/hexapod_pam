from Yuna import Yuna
import time
import torch
import numpy as np

leg_idxs = [1]
pos = torch.tensor([[1.4, -0.3, 0.6]])

# leg_idxs = [0, 1]
# pos = torch.tensor([[1.4, 0.3, 0.7], [1.4, -0.3, 0.6]])

yuna = Yuna(real_robot_control=0, pybullet_on=1, opt_vis=True, load_fyp_map=True, goal=pos.tolist())
yuna.env.camerafollow = False

# yuna.height_map.plot()

yuna.pam(pos, leg_idxs)

# --- SET 1 ---
# body_waypoints = np.array([
#     [0.1419, 0.019, 0.1654],
#     [0.2829, 0.0294, 0.2745],
#     [0.4245, 0.0462, 0.2988],
#     [0.5641, 0.0559, 0.2803],
#     [0.7079, 0.0742, 0.37],
#     [0.848, 0.0906, 0.3968]
# ], dtype=np.float32)

# legs_waypoints = np.array([
#     [[0.6388, 0.6382, 0.1753, 0.181, -0.3125, -0.3161],
#      [0.2601, -0.2203, 0.5248, -0.4851, 0.3358, -0.2934],
#      [0.0259, 0.0255, 0.0243, 0.0265, 0.0246, 0.0261]],
#     [[0.7441, 0.7435, 0.3383, 0.3413, -0.1741, -0.1797],
#      [0.2763, -0.2182, 0.5432, -0.4821, 0.3463, -0.2899],
#      [0.2081, 0.2088, 0.0315, 0.0356, 0.0307, 0.0358]],
#     [[0.8851, 0.8938, 0.4752, 0.4675, -0.0413, -0.035],
#      [0.3035, -0.2112, 0.5611, -0.4687, 0.3638, -0.2691],
#      [0.2181, 0.2166, 0.0418, 0.0375, 0.0426, 0.035]],
#     [[1.0231, 1.0228, 0.6003, 0.5905, 0.0983, 0.1096],
#      [0.3169, -0.2116, 0.5687, -0.4565, 0.3766, -0.2713],
#      [0.2093, 0.2096, 0.0538, 0.0467, 0.0638, 0.0591]],
#     [[1.1638, 1.1594, 0.7411, 0.7434, 0.255, 0.2535],
#      [0.3321, -0.1882, 0.5811, -0.4313, 0.3763, -0.2293],
#      [0.3065, 0.3068, 0.2233, 0.2223, 0.0425, 0.0388]],
#     [[1.3426, 1.4028, 0.9865, 1.0742, 0.4148, 0.4699],
#      [0.1473, -0.2984, 0.5589, -0.3451, 0.3898, -0.2757],
#      [0.3233, 0.5976, 0.2491, 0.2275, 0.0341, 0.0412]]
# ], dtype=np.float32)

# body waypoints: [array([0.144 , 0.0105, 0.1697], dtype=float32), array([0.2892, 0.0186, 0.2529], dtype=float32), array([0.43  , 0.0254, 0.276 ], dtype=float32), array([0.5682, 0.028 , 0.2867], dtype=float32), array([0.7134, 0.0379, 0.357 ], dtype=float32), array([0.8562, 0.0454, 0.3976], dtype=float32)]
# legs waypoints: [array([[ 0.6389,  0.6406,  0.1834,  0.1799, -0.3162, -0.3131],
#        [ 0.2524, -0.2316,  0.5183, -0.4986,  0.3228, -0.3019],
#        [ 0.0208,  0.0333,  0.0232,  0.0232,  0.022 ,  0.0201]],
#       dtype=float32), array([[ 0.7475,  0.7525,  0.3302,  0.3256, -0.1788, -0.1756],
#        [ 0.2809, -0.2435,  0.5307, -0.4943,  0.3275, -0.2919],
#        [ 0.1841,  0.1816,  0.0435,  0.0474,  0.05  ,  0.0487]],
#       dtype=float32), array([[ 0.8983,  0.88  ,  0.4609,  0.4809, -0.0341, -0.0282],
#        [ 0.2811, -0.2567,  0.5426, -0.4834,  0.3371, -0.2944],
#        [ 0.2041,  0.1996,  0.0558,  0.0408,  0.0557,  0.0542]],
#       dtype=float32), array([[ 1.0286,  1.031 ,  0.6148,  0.6143,  0.1096,  0.1033],
#        [ 0.2879, -0.2256,  0.5402, -0.4893,  0.3464, -0.2874],
#        [ 0.2201,  0.2205,  0.0335,  0.0477,  0.0417,  0.047 ]],
#       dtype=float32), array([[ 1.1712,  1.1578,  0.749 ,  0.7322,  0.249 ,  0.2622],
#        [ 0.2919, -0.2279,  0.5438, -0.4706,  0.3338, -0.2776],
#        [ 0.3009,  0.3038,  0.212 ,  0.1999,  0.0629,  0.0601]],
#       dtype=float32), array([[ 1.3553,  1.399 ,  0.9945,  1.0821,  0.4212,  0.4766],
#        [ 0.0946, -0.3093,  0.517 , -0.3901,  0.3458, -0.3248],
#        [ 0.3116,  0.5886,  0.2487,  0.2232,  0.0398,  0.0515]],
#       dtype=float32)]

# yuna.pam_move(body_waypoints, legs_waypoints)

time.sleep(10)

# NOTE: kinda working now but need fix the last leg raising up (singularity problem?)
